<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>51Degrees Device Detection C/C++: Hash/OfflineProcessing.c</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>

<link href="docs-main.min.css" rel="stylesheet" type="text/css" />

</head>
<body class="l-docs-index p-doxygen">
<div class="l-index__content">
<!--div id="top"--><!-- do not remove this div, it is closed by doxygen! -->


<div id="titlearea" class="g-header g-header--docs">
  <h1 class="c-brand">
  
  <a id="projectlogo" href="../../documentation/4.1/index.html" class="c-brand__link"><img class="c-brand__image" alt="Logo" src="logo-51Degrees-Docs.png"/></a>
  
  <span class="c-tagline">51Degrees Device Detection C/C++
   &#160;<span id="projectnumber">4.1</span>
  </span>
  
  </h1>
  
  <div id="projectalign" style="padding-left: 0.5em;">
   <div id="projectbrief">A device detection library that is used natively or by 51Degrees products</div>
  </div>
  
  <div id="main-nav"></div>
  
   
     <div class="g-search">
    <div class="c-search is-openable">
    <form class="c-search__form">
      <div id="MSearchBox" class="b-form-group b-form-group--with-icon">
        <label for="inputSearch" class="b-text--hidden">Search</label>
        <img id="MSearchSelect" src="icon-search.svg" class="b-icon" alt="Search" 
                 onmouseover="return searchBox.OnSearchSelectShow()"
                 onmouseout="return searchBox.OnSearchSelectHide()"/>
        <input type="text" id="MSearchField" autocomplete="off" class="c-search__input" id="inputSearch" placeholder="Type a class, namespace etc." aria-label="Search"
                 onfocus="searchBox.OnSearchFieldFocus(true)" 
                 onblur="searchBox.OnSearchFieldFocus(false)" 
                 onkeyup="searchBox.OnSearchFieldChange(event)">
         <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
      </div>
    </form>
  </div>
</div>

   
  
</div>

<!-- end header part -->
<main class="g-main">
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<!-- top -->
	<div class="g-docs__sidenav">																														         <nav id="nav-tree-contents" class="c-sidenav">																														     <h4 class="c-sidenav__heading">Documentation</h4>																									         <div id="nav-sync" class="sync"></div>
  <ul class="c-sidenav__list">																														     </ul>																																				   </nav>    </div><script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('_hash_2_offline_processing_8c-example.html','');});
/* @license-end */
</script>
<div id="doc-content" class="g-docs__content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="g-docs__header">
<h2 class="g-docs__page-title">Hash/OfflineProcessing.c</h2></div><!--header-->
<div class="g-docs__inner">
<div class="g-docs__primary" id="primary">
<p>Offline processing example of using 51Degrees device detection.The example shows how to:</p>
<ol type="1">
<li>Specify the name of the data file and properties the data set should be initialised with. <div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* fileName = argv[1];</div><div class="c-code__line"><a name="_a0"></a><a class="code" href="structfiftyone_degrees_properties_required.html">fiftyoneDegreesPropertiesRequired</a> properties =</div><div class="c-code__line">    <a name="a1"></a><a class="code" href="group___fifty_one_degrees_properties.html#gaa9a8fcd6d3c80b7eace503cebd4f4e0d">fiftyoneDegreesPropertiesDefault</a>;</div><div class="c-code__line">properties.<a name="a2"></a><a class="code" href="structfiftyone_degrees_properties_required.html#a7044785e8c67e2d208ba1010ec355d5c">string</a> = <span class="c-code__stringliteral">&quot;IsMobile&quot;</span>;</div></div></li>
<li>Instantiate the 51Degrees data set within a resource manager from the specified data file with the required properties and the specified configuration. <div class="c-code__block c-code__block--outline"><div class="c-code__line"><a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">fiftyoneDegreesStatusCode</a> status =</div><div class="c-code__line">    <a name="a3"></a><a class="code" href="group___fifty_one_degrees_hash_api.html#gabd7a393485064fd721a228f1ec798cb6">fiftyoneDegreesHashInitManagerFromFile</a>(</div><div class="c-code__line">        &amp;manager,</div><div class="c-code__line">        &amp;config,</div><div class="c-code__line">        &amp;properties,</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        exception);</div></div></li>
<li>Create a results instance ready to be populated by the data set. <div class="c-code__block c-code__block--outline"><div class="c-code__line"><a name="_a4"></a><a class="code" href="structfiftyone_degrees_result_hash_array.html">fiftyoneDegreesResultsHash</a>*results =</div><div class="c-code__line">    <a name="a5"></a><a class="code" href="group___fifty_one_degrees_hash_api.html#gaebeeaad43d8f124440a8264e25593ae8">fiftyoneDegreesResultsHashCreate</a>(</div><div class="c-code__line">        &amp;manager,</div><div class="c-code__line">        1,</div><div class="c-code__line">        0);</div></div></li>
<li>Open an output file to write the results to. <div class="c-code__block c-code__block--outline"><div class="c-code__line">FILE* fout = fopen(outputFile, <span class="c-code__stringliteral">&quot;w&quot;</span>);</div></div></li>
<li>Write a header to the output file with the property names in '|' separated CSV format ('|' separated because some User-Agents contain commas) <div class="c-code__block c-code__block--outline"><div class="c-code__line">fprintf(fout, <span class="c-code__stringliteral">&quot;User-Agent&quot;</span>);</div><div class="c-code__line"><span class="c-code__keywordflow">for</span> (i = 0; i &lt; dataSet-&gt;b.b.available-&gt;count; i++) {</div><div class="c-code__line">    fprintf(fout, <span class="c-code__stringliteral">&quot;,\&quot;%s\&quot;&quot;</span>,</div><div class="c-code__line">        &amp;((<a name="_a6"></a><a class="code" href="structfiftyone_degrees_string.html">fiftyoneDegreesString</a>*)</div><div class="c-code__line">            dataSet-&gt;b.b.available-&gt;items[i].name.data.ptr)-&gt;value);</div><div class="c-code__line">}</div><div class="c-code__line">fprintf(fout, <span class="c-code__stringliteral">&quot;\n&quot;</span>);</div></div></li>
<li>Iterate over the User-Agents in an input file writing the processing results to the output file. <div class="c-code__block c-code__block--outline"><div class="c-code__line"><a name="a7"></a><a class="code" href="group___fifty_one_degrees_text_file.html#ga889f7475e355308b10815267d698d851">fiftyoneDegreesTextFileIterate</a>(</div><div class="c-code__line">    userAgentFilePath,</div><div class="c-code__line">    userAgent,</div><div class="c-code__line">    <span class="c-code__keyword">sizeof</span>(userAgent),</div><div class="c-code__line">    &amp;state,</div><div class="c-code__line">    executeTest);</div></div></li>
<li>Finally release the memory used by the data set resource. <div class="c-code__block c-code__block--outline"><div class="c-code__line"><a name="a8"></a><a class="code" href="group___fifty_one_degrees_resource.html#gaafa0bcda0487c58d01d1232d074aa3cc">fiftyoneDegreesResourceManagerFree</a>(&amp;manager);</div></div></li>
</ol>
<p>This example demonstrates one possible use of the API and device data for offline data processing. It also demonstrates that you can reuse the retrieved results for multiple uses and only then release it.</p>
<div class="c-code__block c-code__block--outline"><div class="c-code__line"><span class="c-code__comment">/* *********************************************************************</span></div><div class="c-code__line"><span class="c-code__comment"> * This Source Code Form is copyright of 51 Degrees Mobile Experts Limited.</span></div><div class="c-code__line"><span class="c-code__comment"> * Copyright 2019 51 Degrees Mobile Experts Limited, 5 Charlotte Close,</span></div><div class="c-code__line"><span class="c-code__comment"> * Caversham, Reading, Berkshire, United Kingdom RG4 7BY</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Source Code Form is subject to the terms of the Mozilla Public</span></div><div class="c-code__line"><span class="c-code__comment"> * License, v. 2.0.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * If a copy of the MPL was not distributed with this file, You can obtain</span></div><div class="c-code__line"><span class="c-code__comment"> * one at http://mozilla.org/MPL/2.0/.</span></div><div class="c-code__line"><span class="c-code__comment"> *</span></div><div class="c-code__line"><span class="c-code__comment"> * This Source Code Form is &quot;Incompatible With Secondary Licenses&quot;, as</span></div><div class="c-code__line"><span class="c-code__comment"> * defined by the Mozilla Public License, v. 2.0.</span></div><div class="c-code__line"><span class="c-code__comment"> * ********************************************************************* */</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line"><span class="c-code__preprocessor">#define _CRTDBG_MAP_ALLOC</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &lt;crtdbg.h&gt;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#else</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;dmalloc.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/hash/hash.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/common-cxx/textfile.h&quot;</span></div><div class="c-code__line"><span class="c-code__preprocessor">#include &quot;../../../src/hash/fiftyone.h&quot;</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *dataDir = <span class="c-code__stringliteral">&quot;device-detection-data&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *dataFileName = <span class="c-code__stringliteral">&quot;51Degrees-LiteV3.4.trie&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *userAgentFileName = <span class="c-code__stringliteral">&quot;20000 User Agents.csv&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">char</span> valueBuffer[1024] = <span class="c-code__stringliteral">&quot;&quot;</span>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">char</span>* getPropertyValueAsString(</div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_result_hash_array.html">ResultsHash</a>*results,</div><div class="c-code__line">    uint32_t requiredPropertyIndex) {</div><div class="c-code__line">    <a name="a9"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line">    <a name="a10"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#gaf8afba6a40988001e2cbd672049ba331">ResultsHashGetValueStringByRequiredPropertyIndex</a>(</div><div class="c-code__line">        results,</div><div class="c-code__line">        requiredPropertyIndex,</div><div class="c-code__line">        valueBuffer,</div><div class="c-code__line">        <span class="c-code__keyword">sizeof</span>(valueBuffer),</div><div class="c-code__line">        exception);</div><div class="c-code__line">    <a name="a11"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga1d1a54ffb69cad881269379cc5af3f35">EXCEPTION_THROW</a>;</div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> valueBuffer;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#define CONFIG fiftyoneDegreesHashInMemoryConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesHashHighPerformanceConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesHashLowMemoryConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesHashBalancedConfig</span></div><div class="c-code__line"><span class="c-code__comment">// #define CONFIG fiftyoneDegreesHashBalancedTempConfig</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">typedef</span> <span class="c-code__keyword">struct </span>t_offline_processing_state {</div><div class="c-code__line">    FILE *output; </div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_result_hash_array.html">ResultsHash</a> *results; </div><div class="c-code__line">} <a name="_a12"></a><a class="code" href="structoffline_process_state.html">offlineProcessState</a>;</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> process(<span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *userAgent, <span class="c-code__keywordtype">void</span> *state) {</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line">    uint32_t i;</div><div class="c-code__line">    <a class="code" href="structoffline_process_state.html">offlineProcessState</a> *offline = (<a class="code" href="structoffline_process_state.html">offlineProcessState</a>*)state;</div><div class="c-code__line">    <a name="_a13"></a><a class="code" href="structfiftyone_degrees_result_hash.html">ResultHash</a> *result;</div><div class="c-code__line">    <a name="_a14"></a><a class="code" href="structfiftyone_degrees_data_set_hash.html">DataSetHash</a> *dataSet = (<a class="code" href="structfiftyone_degrees_data_set_hash.html">DataSetHash</a>*)offline-&gt;<a name="a15"></a><a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>-&gt;<a name="a16"></a><a class="code" href="structfiftyone_degrees_result_hash_array.html#a0b613284cd3b79bbcb76cd694b77ac91">b</a>.<a name="a17"></a><a class="code" href="structfiftyone_degrees_results_device_detection.html#ab274eced26b8fd68a8170b27dac75dde">b</a>.<a name="a18"></a><a class="code" href="structfiftyone_degrees_results_base.html#acb1eb8a8fb245ea49299b19fd71fa1d5">dataSet</a>;</div><div class="c-code__line">    <a name="a19"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#gaaa8593ec2113571b134be63bae268209">ResultsHashFromUserAgent</a>(</div><div class="c-code__line">        offline-&gt;<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>,</div><div class="c-code__line">        userAgent,</div><div class="c-code__line">        strlen(userAgent),</div><div class="c-code__line">        exception);</div><div class="c-code__line">    result = (<a class="code" href="structfiftyone_degrees_result_hash.html">ResultHash</a>*)offline-&gt;<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>-&gt;<a name="a20"></a><a class="code" href="structfiftyone_degrees_result_hash_array.html#a46ae4c1bac21d2f89a940339f81da461">items</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Write the User-Agent, method, difference and rank.</span></div><div class="c-code__line">    fprintf(</div><div class="c-code__line">        offline-&gt;<a name="a21"></a><a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>,</div><div class="c-code__line">        <span class="c-code__stringliteral">&quot;\&quot;%s\&quot;,%i,%i,%i&quot;</span>, </div><div class="c-code__line">        result-&gt;<a name="a22"></a><a class="code" href="structfiftyone_degrees_result_hash.html#a1bf6d4fbfe2e5dbb3c50947eefa05fcf">b</a>.<a name="a23"></a><a class="code" href="structfiftyone_degrees_result_user_agent.html#a8cdadf30ba9ac48aee2c1dc4368c2656">matchedUserAgent</a> == NULL ? userAgent : result-&gt;<a class="code" href="structfiftyone_degrees_result_hash.html#a1bf6d4fbfe2e5dbb3c50947eefa05fcf">b</a>.<a class="code" href="structfiftyone_degrees_result_user_agent.html#a8cdadf30ba9ac48aee2c1dc4368c2656">matchedUserAgent</a>,</div><div class="c-code__line">        result-&gt;<a name="a24"></a><a class="code" href="structfiftyone_degrees_result_hash.html#a6e8959c41263ac9f20f01225be891567">drift</a>, </div><div class="c-code__line">        result-&gt;<a name="a25"></a><a class="code" href="structfiftyone_degrees_result_hash.html#a5b43d091fc2541c29881bad87434b9bb">difference</a>, </div><div class="c-code__line">        result-&gt;<a name="a26"></a><a class="code" href="structfiftyone_degrees_result_hash.html#a990f17a7426a1fe4e875074c1b80292d">iterations</a>);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Write all the available properties.</span></div><div class="c-code__line">    <span class="c-code__keywordflow">for</span> (i = 0; i &lt; dataSet-&gt;<a name="a27"></a><a class="code" href="structfiftyone_degrees_data_set_hash.html#a55d7db87af4c400bca7d04581a95b533">b</a>.<a name="a28"></a><a class="code" href="structfiftyone_degrees_data_set_device_detection.html#a69c6c6bb7cf4fea8d484e3dbe01053fb">b</a>.<a name="a29"></a><a class="code" href="structfiftyone_degrees_data_set_base.html#afb6fe7080fd386b7b4233ce5c87ce3c2">available</a>-&gt;<a name="a30"></a><a class="code" href="structfiftyone_degrees_property_available_array.html#a931e016a455f0ace924c2df65db6a54e">count</a>; i++) {</div><div class="c-code__line">        <span class="c-code__keywordflow">if</span> (<a name="a31"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#gaadda447a6bc77d46740ed8b76ed60ee2">ResultsHashGetValue</a>(</div><div class="c-code__line">            offline-&gt;<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>,</div><div class="c-code__line">            i,</div><div class="c-code__line">            exception) == NULL || <a name="a32"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gaa6fedae3018531c6fefd2d535c7fc8cc">EXCEPTION_FAILED</a>) {</div><div class="c-code__line">            <span class="c-code__comment">// Write an empty value if one isn&#39;t available.</span></div><div class="c-code__line">            fprintf(offline-&gt;<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>,<span class="c-code__stringliteral">&quot;,\&quot;\&quot;&quot;</span>);</div><div class="c-code__line">        } </div><div class="c-code__line">        <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line"></div><div class="c-code__line">            <span class="c-code__comment">// Write value(s) with comma separator.</span></div><div class="c-code__line">            fprintf(offline-&gt;<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;,\&quot;&quot;</span>);</div><div class="c-code__line">            fprintf(offline-&gt;<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;%s&quot;</span>, getPropertyValueAsString(</div><div class="c-code__line">                offline-&gt;<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>, </div><div class="c-code__line">                i));</div><div class="c-code__line">            fprintf(offline-&gt;<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;\&quot;&quot;</span>);</div><div class="c-code__line">        }</div><div class="c-code__line">    }</div><div class="c-code__line">    fprintf(offline-&gt;<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;\n&quot;</span>);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordtype">void</span> run(</div><div class="c-code__line">    <a name="_a33"></a><a class="code" href="structfiftyone_degrees_resource_manager.html">ResourceManager</a> *manager, </div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *userAgentFilePath, </div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *outputFilePath) {</div><div class="c-code__line">    uint32_t i;</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> userAgent[1000];</div><div class="c-code__line">    <a class="code" href="structoffline_process_state.html">offlineProcessState</a> state;</div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_data_set_hash.html">DataSetHash</a> *dataSet;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Open a fresh data file for writing the output to.</span></div><div class="c-code__line">    <a name="a34"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gacf90f6c3d896757c8fabdf548da658e1">FileDelete</a>(outputFilePath);</div><div class="c-code__line">    state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a> = fopen(outputFilePath, <span class="c-code__stringliteral">&quot;w&quot;</span>);</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a> == NULL) {</div><div class="c-code__line">        printf(<span class="c-code__stringliteral">&quot;Could not open file %s for write\n&quot;</span>, outputFilePath);</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span>;</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Get the results and data set from the manager. Use a higher closest </span></div><div class="c-code__line">    <span class="c-code__comment">// number of signatures than the default because performance is less </span></div><div class="c-code__line">    <span class="c-code__comment">// important for offline processing and expanding the number of </span></div><div class="c-code__line">    <span class="c-code__comment">// alternatives evaluated can lead to a better result.</span></div><div class="c-code__line">    state.<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a> = <a name="a35"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#ga6eee92bf88015e1e2caba34a2f4589d6">ResultsHashCreate</a>(manager, 1, 0);</div><div class="c-code__line">    dataSet = (<a class="code" href="structfiftyone_degrees_data_set_hash.html">DataSetHash</a>*)state.<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>-&gt;<a class="code" href="structfiftyone_degrees_result_hash_array.html#a0b613284cd3b79bbcb76cd694b77ac91">b</a>.<a class="code" href="structfiftyone_degrees_results_device_detection.html#ab274eced26b8fd68a8170b27dac75dde">b</a>.<a class="code" href="structfiftyone_degrees_results_base.html#acb1eb8a8fb245ea49299b19fd71fa1d5">dataSet</a>;</div><div class="c-code__line">                </div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Starting Offline Processing Example.\n&quot;</span>);</div><div class="c-code__line">    </div><div class="c-code__line">    <span class="c-code__comment">// Print CSV headers to output file.</span></div><div class="c-code__line">    fprintf(state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;\&quot;User-Agent\&quot;,\&quot;Drift\&quot;,\&quot;Difference\&quot;,\&quot;Iterations\&quot;&quot;</span>);</div><div class="c-code__line">    <span class="c-code__keywordflow">for</span> (i = 0; i &lt; dataSet-&gt;<a class="code" href="structfiftyone_degrees_data_set_hash.html#a55d7db87af4c400bca7d04581a95b533">b</a>.<a class="code" href="structfiftyone_degrees_data_set_device_detection.html#a69c6c6bb7cf4fea8d484e3dbe01053fb">b</a>.<a class="code" href="structfiftyone_degrees_data_set_base.html#afb6fe7080fd386b7b4233ce5c87ce3c2">available</a>-&gt;<a class="code" href="structfiftyone_degrees_property_available_array.html#a931e016a455f0ace924c2df65db6a54e">count</a>; i++) {</div><div class="c-code__line">        fprintf(state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;,\&quot;%s\&quot;&quot;</span>, </div><div class="c-code__line">            &amp;((<a class="code" href="structfiftyone_degrees_string.html">String</a>*)dataSet-&gt;<a class="code" href="structfiftyone_degrees_data_set_hash.html#a55d7db87af4c400bca7d04581a95b533">b</a>.<a class="code" href="structfiftyone_degrees_data_set_device_detection.html#a69c6c6bb7cf4fea8d484e3dbe01053fb">b</a>.<a class="code" href="structfiftyone_degrees_data_set_base.html#afb6fe7080fd386b7b4233ce5c87ce3c2">available</a>-&gt;<a name="a36"></a><a class="code" href="structfiftyone_degrees_property_available_array.html#ad5009b422ab3c6c4357b1836a86480fe">items</a>[i].<a name="a37"></a><a class="code" href="structfiftyone_degrees_property_available.html#a6b9ef94044966ff6467dce839d793be9">name</a>.<a name="a38"></a><a class="code" href="structfiftyone_degrees_collection_item.html#a2a6c691d3e58694438f2b5575a2d7f08">data</a>.<a name="a39"></a><a class="code" href="structfiftyone_degrees_data.html#a838d52f2eb8fdc33d239ce30fe4f1fe5">ptr</a>)-&gt;value);</div><div class="c-code__line">    }</div><div class="c-code__line">    fprintf(state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>, <span class="c-code__stringliteral">&quot;\n&quot;</span>);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Perform offline processing.</span></div><div class="c-code__line">    <a name="a40"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga30a121270e734fb65269e97ba79b2e3d">TextFileIterate</a>(</div><div class="c-code__line">        userAgentFilePath,</div><div class="c-code__line">        userAgent,</div><div class="c-code__line">        <span class="c-code__keyword">sizeof</span>(userAgent),</div><div class="c-code__line">        &amp;state,</div><div class="c-code__line">        process);</div><div class="c-code__line"></div><div class="c-code__line">    fclose(state.<a class="code" href="structoffline_process_state.html#a244c8bf9cdc887b4842621392cee70ef">output</a>);</div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Output Written to %s\n&quot;</span>, outputFilePath);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Free the memory used by the results instance.</span></div><div class="c-code__line">    <a name="a41"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#gaef12979129e46a5fd7ebb6be8867a88d">ResultsHashFree</a>(state.<a class="code" href="structoffline_process_state.html#a409122745b78a768bbd438eb9d08c148">results</a>);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keyword">static</span> <span class="c-code__keywordtype">void</span> reportStatus(</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span>* fileName) {</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *message = <a name="a42"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga3002890a18e3a86e4078880f2b00bbad">StatusGetMessage</a>(status, fileName);</div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;%s\n&quot;</span>, message);</div><div class="c-code__line">    <a name="a43"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gae0ecd1fc988dbb64ff0232a001e090bf">Free</a>((<span class="c-code__keywordtype">void</span>*)message);</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordtype">void</span> fiftyoneDegreesOfflineProcessingRun(</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *dataFilePath,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *userAgentFilePath,</div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *outputFilePath, </div><div class="c-code__line">    <span class="c-code__keyword">const</span> <span class="c-code__keywordtype">char</span> *requiredProperties,</div><div class="c-code__line">    <a name="_a44"></a><a class="code" href="structfiftyone_degrees_config_hash.html">ConfigHash</a> config) {</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_synonyms.html#ga29a7b1eb8b59c26629548b1de83b473b">EXCEPTION_CREATE</a>;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set concurrency to ensure sufficient shared resources available.</span></div><div class="c-code__line">    config.<a name="a45"></a><a class="code" href="structfiftyone_degrees_config_hash.html#ae6f2cc08ef87f41faa4e425cc3fb82cb">components</a>.<a name="a46"></a><a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a47"></a><a class="code" href="structfiftyone_degrees_config_hash.html#a5476be1948230837b742d4feb2c58281">nodes</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a48"></a><a class="code" href="structfiftyone_degrees_config_hash.html#acd156b439ec81a3f3f417e9042bcf60a">profiles</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a49"></a><a class="code" href="structfiftyone_degrees_config_hash.html#a49e425bb6e974965fd49cd01e95822f1">properties</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a50"></a><a class="code" href="structfiftyone_degrees_config_hash.html#a6f3a2f97012d0257a8666e2aa7fe5bb8">devices</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> =</div><div class="c-code__line">        config.<a name="a51"></a><a class="code" href="structfiftyone_degrees_config_hash.html#a88936a51b61e8d8caea7050e70dd1a57">strings</a>.<a class="code" href="structfiftyone_degrees_collection_config.html#af3dee101ea5b465a0a40f1899487e041">concurrency</a> = 1;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// If time can be sacrificed for a more thorough analysis of the different</span></div><div class="c-code__line">    <span class="c-code__comment">// options then increase the closestSignatures value. More permutations </span></div><div class="c-code__line">    <span class="c-code__comment">// will be considered the higher the number.</span></div><div class="c-code__line">    <span class="c-code__comment">// config.closestSignatures = 50000;</span></div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set the required properties for the output file.</span></div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_properties_required.html">PropertiesRequired</a> properties = <a name="a52"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga246be0840df800ead0edc55949e2e92e">PropertiesDefault</a>;</div><div class="c-code__line">    properties.<a class="code" href="structfiftyone_degrees_properties_required.html#a7044785e8c67e2d208ba1010ec355d5c">string</a> = requiredProperties;</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Set the User-Agent update so that we can output the sub strings found </span></div><div class="c-code__line">    <span class="c-code__comment">// and not the entire User-Agent.</span></div><div class="c-code__line">    config.<a name="a53"></a><a class="code" href="structfiftyone_degrees_config_hash.html#a7df616c1c12c853ce8042fa41a184f3f">b</a>.<a name="a54"></a><a class="code" href="structfiftyone_degrees_config_device_detection.html#acee39f8a3a01a5763741e765f9eca8c3">updateMatchedUserAgent</a> = <span class="c-code__keyword">true</span>;</div><div class="c-code__line"></div><div class="c-code__line">    <a class="code" href="structfiftyone_degrees_resource_manager.html">ResourceManager</a> manager;</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status = <a name="a55"></a><a class="code" href="group___fifty_one_degrees_hash_synonyms.html#gaf32e91a9120e015fb219a3044498f7bc">HashInitManagerFromFile</a>(</div><div class="c-code__line">        &amp;manager,</div><div class="c-code__line">        &amp;config,</div><div class="c-code__line">        &amp;properties,</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        exception);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a name="a56"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, dataFilePath);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Process the User-Agents writing the results to the output path.</span></div><div class="c-code__line">        run(&amp;manager, userAgentFilePath, outputFilePath);</div><div class="c-code__line"></div><div class="c-code__line">        <span class="c-code__comment">// Free the memory used by the data set.</span></div><div class="c-code__line">        <a name="a57"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gac5094875841e9d95dc972014124ea765">ResourceManagerFree</a>(&amp;manager);</div><div class="c-code__line">    }</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifndef TEST</span></div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__keywordtype">int</span> main(<span class="c-code__keywordtype">int</span> argc, <span class="c-code__keywordtype">char</span>* argv[]) {</div><div class="c-code__line">    <span class="c-code__keywordtype">int</span> i = 0;</div><div class="c-code__line">    <a class="code" href="group___fifty_one_degrees_status.html#ga887881c8b6ec9f0c8510913831ebd19e">StatusCode</a> status = <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>;</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> dataFilePath[<a name="a58"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#gafd3ee670ff4ed3f29a395abd2f0f3344">FILE_MAX_PATH</a>];</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> userAgentFilePath[<a class="code" href="group___fifty_one_degrees_synonyms.html#gafd3ee670ff4ed3f29a395abd2f0f3344">FILE_MAX_PATH</a>];</div><div class="c-code__line">    <span class="c-code__keywordtype">char</span> outputFilePath[<a class="code" href="group___fifty_one_degrees_synonyms.html#gafd3ee670ff4ed3f29a395abd2f0f3344">FILE_MAX_PATH</a>];</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (argc &gt; 1) {</div><div class="c-code__line">        strcpy(dataFilePath, argv[1]);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        status = <a name="a59"></a><a class="code" href="group___fifty_one_degrees_synonyms.html#ga5ba06bcfd18437e9145833037dd7ecc9">FileGetPath</a>(</div><div class="c-code__line">            dataDir,</div><div class="c-code__line">            dataFileName,</div><div class="c-code__line">            dataFilePath,</div><div class="c-code__line">            <span class="c-code__keyword">sizeof</span>(dataFilePath));</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, dataFileName);</div><div class="c-code__line">        fgetc(stdin);</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span> 1;</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (argc &gt; 2) {</div><div class="c-code__line">        strcpy(userAgentFilePath, argv[2]);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        status = <a class="code" href="group___fifty_one_degrees_synonyms.html#ga5ba06bcfd18437e9145833037dd7ecc9">FileGetPath</a>(</div><div class="c-code__line">            dataDir,</div><div class="c-code__line">            userAgentFileName,</div><div class="c-code__line">            userAgentFilePath,</div><div class="c-code__line">            <span class="c-code__keyword">sizeof</span>(userAgentFilePath));</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (status != <a class="code" href="group___fifty_one_degrees_synonyms.html#gaa90cac659d18e8ef6294c7ae337f6b58">SUCCESS</a>) {</div><div class="c-code__line">        reportStatus(status, userAgentFilePath);</div><div class="c-code__line">        fgetc(stdin);</div><div class="c-code__line">        <span class="c-code__keywordflow">return</span> 1;</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">if</span> (argc &gt; 3) {</div><div class="c-code__line">        strcpy(outputFilePath, argv[3]);</div><div class="c-code__line">    }</div><div class="c-code__line">    <span class="c-code__keywordflow">else</span> {</div><div class="c-code__line">        <span class="c-code__keywordflow">while</span> (userAgentFilePath[i] != <span class="c-code__charliteral">&#39;.&#39;</span> &amp;&amp; userAgentFilePath[i] != <span class="c-code__charliteral">&#39;\0&#39;</span>) {</div><div class="c-code__line">            outputFilePath[i] = userAgentFilePath[i];</div><div class="c-code__line">            i++;</div><div class="c-code__line">        }</div><div class="c-code__line">        strcpy(&amp;outputFilePath[i], <span class="c-code__stringliteral">&quot;.processed.csv&quot;</span>);</div><div class="c-code__line">    }</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifndef _MSC_VER</span></div><div class="c-code__line">    dmalloc_debug_setup(<span class="c-code__stringliteral">&quot;log-stats,log-non-free,check-fence,log=dmalloc.log&quot;</span>);</div><div class="c-code__line"><span class="c-code__preprocessor">#else</span></div><div class="c-code__line">    _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);</div><div class="c-code__line">    _CrtSetReportFile(_CRT_WARN, _CRTDBG_FILE_STDERR);</div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Start the offline processing.</span></div><div class="c-code__line">    fiftyoneDegreesOfflineProcessingRun(</div><div class="c-code__line">        dataFilePath,</div><div class="c-code__line">        userAgentFilePath,</div><div class="c-code__line">        outputFilePath,</div><div class="c-code__line">        argc &gt; 4 ? argv[4] : <span class="c-code__stringliteral">&quot;IsMobile,BrowserName,DeviceType,PriceBand,&quot;</span></div><div class="c-code__line">                             <span class="c-code__stringliteral">&quot;ReleaseMonth,ReleaseYear&quot;</span>,</div><div class="c-code__line">        CONFIG);</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _DEBUG</span></div><div class="c-code__line"><span class="c-code__preprocessor">#ifdef _MSC_VER</span></div><div class="c-code__line">    _CrtDumpMemoryLeaks();</div><div class="c-code__line"><span class="c-code__preprocessor">#else</span></div><div class="c-code__line">    printf(<span class="c-code__stringliteral">&quot;Log file is %s\r\n&quot;</span>, dmalloc_logpath);</div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__comment">// Wait for a character to be pressed.</span></div><div class="c-code__line">    fgetc(stdin);</div><div class="c-code__line"></div><div class="c-code__line">    <span class="c-code__keywordflow">return</span> 0;</div><div class="c-code__line">}</div><div class="c-code__line"></div><div class="c-code__line"><span class="c-code__preprocessor">#endif</span></div></div> </div><!-- primary -->
</div><!-- inner-->
<!-- HTML footer for doxygen 1.8.15-->
<!-- start footer part -->
<section id="nav-path" class="g-footer g-footer--docs"><!-- id is needed for treeview function! -->
    <p class="g-footer__copyright">Generated by
    <a href="http://www.doxygen.org/index.html">
    <b>doxygen</b></a> 1.8.15
  </p>
</section>
</div>
</main>
</div>
</body>
</html>
